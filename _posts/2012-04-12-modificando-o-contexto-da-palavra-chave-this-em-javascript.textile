---
layout: post
title: Modificando o contexto da palavra-chave this em JavaScript
categories: [javascript]
tags: [javascript, var, contexto, escopo]
meta_keywords: javascript, var, contexto, escopo
meta_description: Em JavaScript a palavra-chave this é uma referência ao objeto atual, porem seu contexto pode mudar dependendo da forma como o objeto é tratado
---

Em JavaScript a palavra-chave "<code>this</code>":https://developer.mozilla.org/en/JavaScript/Reference/Operators/this é uma referência ao objeto atual, porem seu contexto pode mudar dependendo da forma como o objeto é tratado

{% highlight javascript %}
function fn(){
    console.log(this);
};

fn(); // this === Window
new fn(); // this === fn
{% endhighlight %}

Em alguns casos como no exemplo abaixo precisamos que <code>this</code> mantenha um determinado contexto:

{% highlight javascript %}
var widget = {
    el: document.getElementById('wgt'),
    hide: function() {
       this.el.style.display = 'none';
    },
    init: function(){
        this.el.onclick = this.hide;
        // na função hide this passa a referenciar widget.el,
        // causando um erro pois não existe this.el neste contexto
        // precisamos que continue referenciando apenas widget
    }
}
widget.init();
{% endhighlight %}

Uma solução seria salvar o valor de <code>this</code> em uma variável, passar uma função anônima para o método <code>onclick</code> e executar a função <code>hide</code>.

{% highlight javascript %}
var widget = {
    el: document.getElementById('wgt'),
    hide: function() {
       this.el.style.display = 'none';
    },
    init: function(){
        var self = this;
        this.el.onclick = function(){
            self.hide();
        }
    }
}
widget.init();
{% endhighlight %}

Não é uma solução muito elegante, e o JavaScript nos permite fazer isso de uma maneira melhor.

h1. Implementando um método <code>bindTo</code> no objeto <code>Function</code>

Usando o método "<code>apply</code>":https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/apply das funções é possivel alterar o contexto de <code>this</code> em funções.
Abaixo um exemplo implementando um novo método no objeto <code>Function</code>:

{% highlight javascript %}
Function.prototype.bindTo = function(obj){
    var fn = this; // referencia para a função atual
    return function(){
        // obj é o objeto para o qual queremos alterar o contexto de this
        // arguments são os argumentos originais que são recebidos na função retornada
        fn.apply(obj, arguments);
    }
}
{% endhighlight %}

O código poderia ser modificado para:

{% highlight javascript %}
var widget = {
    el: document.getElementById('wgt'),
    hide: function() {
       this.el.style.display = 'none';
    },
    init: function(){
        // usando bindTo agora disponível em qualquer função
        this.el.onclick = this.hide.bindTo(this);
    }
}
widget.init();
{% endhighlight %}

h2. Referências

* "this keyword":https://developer.mozilla.org/en/JavaScript/Reference/Operators/this
* "function apply":https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/apply
